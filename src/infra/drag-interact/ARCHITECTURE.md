# Interact.js æ‹–æ”¾ç³»ç»Ÿæ¶æ„

## ğŸ¯ è®¾è®¡ç†å¿µ

**æ ¸å¿ƒåŸåˆ™**ï¼šå½»åº•åˆ†ç¦» UI æ¸²æŸ“å’Œä¸šåŠ¡é€»è¾‘ï¼Œä½¿ç”¨å“åº”å¼æ•°æ®æµé©±åŠ¨é¢„è§ˆã€‚

---

## ğŸ“Š å®Œæ•´æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·æ‹–åŠ¨å¡ç‰‡                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  interact.js draggable.start                                     â”‚
â”‚  â”œâ”€ è°ƒç”¨ startPreparing()                                        â”‚
â”‚  â”œâ”€ åˆ›å»º DragSession (å¿«ç…§ä»»åŠ¡æ•°æ®)                              â”‚
â”‚  â””â”€ è¿›å…¥ PREPARING é˜¶æ®µ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  interact.js draggable.move (æ¯ä¸€å¸§è§¦å‘)                         â”‚
â”‚  â”œâ”€ æ›´æ–°å¹½çµå…ƒç´ ä½ç½® (è·Ÿéšé¼ æ ‡)                                  â”‚
â”‚  â”œâ”€ æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æ‹–æ‹½é˜ˆå€¼ (5px)                                   â”‚
â”‚  â”‚   â””â”€ æ˜¯ â†’ è°ƒç”¨ startDragging(), è¿›å…¥ DRAGGING é˜¶æ®µ          â”‚
â”‚  â””â”€ ğŸ”¥ æ ¸å¿ƒï¼šæ‰‹åŠ¨ç¢°æ’æ£€æµ‹ detectDropzone(clientX, clientY)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  detectDropzone() - æ‰‹åŠ¨ç¢°æ’æ£€æµ‹æ ¸å¿ƒé€»è¾‘                         â”‚
â”‚                                                                   â”‚
â”‚  1ï¸âƒ£ éå†æ‰€æœ‰å·²æ³¨å†Œçš„ dropzone å…ƒç´                               â”‚
â”‚     for (element of registeredElements) {                        â”‚
â”‚       æ£€æŸ¥é¼ æ ‡æ˜¯å¦åœ¨ element.getBoundingClientRect() å†…          â”‚
â”‚     }                                                             â”‚
â”‚                                                                   â”‚
â”‚  2ï¸âƒ£ æ‰¾åˆ°åŒ¹é…çš„åŒºåŸŸ                                              â”‚
â”‚     â”œâ”€ è¯»å– data-zone-id (å¦‚ "daily::2025-10-01")               â”‚
â”‚     â””â”€ è¯»å– data-zone-type ("kanban" | "calendar")              â”‚
â”‚                                                                   â”‚
â”‚  3ï¸âƒ£ æ ¹æ®åŒºåŸŸç±»å‹å¤„ç†                                            â”‚
â”‚     â”œâ”€ Kanban åŒºåŸŸ:                                              â”‚
â”‚     â”‚   â”œâ”€ calculateDropIndexForZone() è®¡ç®—æ’å…¥ä½ç½®              â”‚
â”‚     â”‚   â””â”€ dragPreviewActions.setKanbanPreview()                 â”‚
â”‚     â”‚       â†’ æ›´æ–°å…¨å±€ dragPreviewState                          â”‚
â”‚     â”‚                                                             â”‚
â”‚     â”œâ”€ æ—¥å†åŒºåŸŸ:                                                 â”‚
â”‚     â”‚   â””â”€ dragPreviewActions.triggerRebound()                   â”‚
â”‚     â”‚       â†’ targetZoneId è®¾ä¸º null (è§¦å‘å›å¼¹)                  â”‚
â”‚     â”‚                                                             â”‚
â”‚     â””â”€ æ²¡æœ‰åŒ¹é…åŒºåŸŸ:                                             â”‚
â”‚         â””â”€ dragPreviewActions.triggerRebound()                   â”‚
â”‚                                                                   â”‚
â”‚  4ï¸âƒ£ çŠ¶æ€æœºè½¬æ¢                                                  â”‚
â”‚     DRAGGING â†’ OVER_TARGET (è¿›å…¥æœ‰æ•ˆåŒºåŸŸ)                        â”‚
â”‚     OVER_TARGET â†’ DRAGGING (ç¦»å¼€åŒºåŸŸ)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dragPreviewState (å…¨å±€å“åº”å¼çŠ¶æ€)                               â”‚
â”‚  {                                                                â”‚
â”‚    type: 'kanban',                                                â”‚
â”‚    raw: {                                                         â”‚
â”‚      ghostTask: { id, title, ... },    // è¢«æ‹–åŠ¨çš„ä»»åŠ¡å¿«ç…§      â”‚
â”‚      sourceZoneId: 'daily::2025-10-01', // æºåˆ—è¡¨               â”‚
â”‚      targetZoneId: 'daily::2025-10-02', // ç›®æ ‡åˆ—è¡¨             â”‚
â”‚      mousePosition: { x: 500, y: 300 }  // é¼ æ ‡åæ ‡             â”‚
â”‚    },                                                             â”‚
â”‚    computed: {                                                    â”‚
â”‚      dropIndex: 2                        // æ’å…¥ä½ç½®             â”‚
â”‚    }                                                              â”‚
â”‚  }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ (Vue å“åº”å¼ç³»ç»Ÿè‡ªåŠ¨ä¼ æ’­)
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  useInteractDrag.displayTasks (computed)                         â”‚
â”‚                                                                   â”‚
â”‚  æ ¹æ® dragPreviewState è®¡ç®—æ˜¾ç¤ºçš„ä»»åŠ¡åˆ—è¡¨:                       â”‚
â”‚                                                                   â”‚
â”‚  â”œâ”€ åœºæ™¯A: targetZoneId === å½“å‰è§†å›¾                            â”‚
â”‚  â”‚   1. ä»åˆ—è¡¨ä¸­ç§»é™¤ ghostTask                                  â”‚
â”‚  â”‚   2. åœ¨ dropIndex ä½ç½®æ’å…¥ ghostTask (æ ‡è®° _isPreview)       â”‚
â”‚  â”‚   3. è¿”å›æ–°æ•°ç»„ â†’ Vue é‡æ–°æ¸²æŸ“                               â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€ åœºæ™¯B: sourceZoneId === å½“å‰è§†å›¾ && targetZoneId !== å½“å‰   â”‚
â”‚  â”‚   1. ä»åˆ—è¡¨ä¸­ç§»é™¤ ghostTask                                  â”‚
â”‚  â”‚   2. è¿”å›è¿‡æ»¤åçš„æ•°ç»„ â†’ Vue é‡æ–°æ¸²æŸ“                         â”‚
â”‚  â”‚                                                               â”‚
â”‚  â””â”€ åœºæ™¯C: targetZoneId === null (å›å¼¹)                         â”‚
â”‚      1. è¿”å›åŸå§‹åˆ—è¡¨ (æ‰€æœ‰åˆ—è¡¨æ¢å¤åŸçŠ¶)                          â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vue æ¨¡æ¿è‡ªåŠ¨é‡æ–°æ¸²æŸ“                                            â”‚
â”‚  <KanbanTaskCard v-for="task in displayTasks" :key="task.id" /> â”‚
â”‚                                                                   â”‚
â”‚  - ä»»åŠ¡å¡ç‰‡ä½ç½®å®æ—¶è·Ÿéš dropIndex å˜åŒ–                           â”‚
â”‚  - å®Œå…¨å“åº”å¼ï¼Œæ— éœ€æ‰‹åŠ¨ DOM æ“ä½œ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  interact.js draggable.end                                       â”‚
â”‚  â”œâ”€ å¦‚æœ phase === OVER_TARGET                                   â”‚
â”‚  â”‚   â””â”€ executeDrop() â†’ è°ƒç”¨ç­–ç•¥ç³»ç»Ÿæ‰§è¡Œä¸šåŠ¡é€»è¾‘               â”‚
â”‚  â””â”€ å¦åˆ™                                                         â”‚
â”‚      â””â”€ cancel() â†’ æ¸…ç†çŠ¶æ€ï¼Œå›åˆ° IDLE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ å…³é”®è®¾è®¡å†³ç­–

### 1ï¸âƒ£ **ä¸ºä»€ä¹ˆä½¿ç”¨æ‰‹åŠ¨ç¢°æ’æ£€æµ‹è€Œä¸æ˜¯ dropzone åŸç”Ÿäº‹ä»¶ï¼Ÿ**

**èƒŒæ™¯**ï¼š

- interact.js çš„ `draggable` å’Œ `dropzone` **ç†è®ºä¸Šå¯ä»¥ååŒå·¥ä½œ**
- `dropzone` éœ€è¦æ­£ç¡®é…ç½® `accept` é€‰é¡¹æ¥æŒ‡å®šæ¥å—å“ªäº›å…ƒç´ 
- `dropzone` äº‹ä»¶ï¼ˆ`dragenter`, `dragover`, `drop`ï¼‰åœ¨é…ç½®æ­£ç¡®æ—¶ä¼šè§¦å‘

**ä¸ºä»€ä¹ˆé€‰æ‹©æ‰‹åŠ¨æ£€æµ‹**ï¼š

1. **åŠ¨æ€é€‰æ‹©å™¨é—®é¢˜**ï¼šæˆ‘ä»¬çš„ draggable ä½¿ç”¨åŠ¨æ€é€‰æ‹©å™¨ï¼ˆå¦‚ `.task-card-wrapper-daily-today`ï¼‰ï¼Œ`accept` é…ç½®éš¾ä»¥åŒ¹é…æ‰€æœ‰æƒ…å†µ
2. **æ›´ç²¾ç¡®çš„æ§åˆ¶**ï¼šæ‰‹åŠ¨æ£€æµ‹å¯ä»¥å®æ—¶è®¡ç®— `dropIndex`ï¼Œè€Œ dropzone åŸç”Ÿäº‹ä»¶éœ€è¦é¢å¤–å¤„ç†
3. **æ€§èƒ½å¯æ§**ï¼šå¯ä»¥ç²¾ç¡®æ§åˆ¶æ£€æµ‹æ—¶æœºï¼Œé¿å…ä¸å¿…è¦çš„äº‹ä»¶è§¦å‘
4. **è·¨åŒºåŸŸé¢„è§ˆ**ï¼šæ‰‹åŠ¨æ£€æµ‹æ›´å®¹æ˜“å®ç°"å›å¼¹"ç­‰å¤æ‚äº¤äº’

**å®ç°æ–¹å¼**ï¼š

- åœ¨ `draggable.move` ä¸­æ¯ä¸€å¸§è°ƒç”¨ `detectDropzone()`
- ä½¿ç”¨ `getBoundingClientRect()` è¿›è¡Œå‡ ä½•ç¢°æ’æ£€æµ‹
- ç›´æ¥æ›´æ–°çŠ¶æ€æœºå’Œé¢„è§ˆçŠ¶æ€ï¼Œæ— éœ€ç­‰å¾…äº‹ä»¶å›è°ƒ

### 2ï¸âƒ£ **ä¸ºä»€ä¹ˆä½¿ç”¨æ‰‹åŠ¨ç¢°æ’æ£€æµ‹ï¼Ÿ**

**ä¼˜åŠ¿**ï¼š

- âœ… å®Œå…¨æ§åˆ¶æ£€æµ‹é€»è¾‘
- âœ… å¯ä»¥å®æ—¶è®¡ç®— dropIndex
- âœ… æ”¯æŒå¤æ‚çš„åµŒå¥—å®¹å™¨
- âœ… æ€§èƒ½å¯æ§ï¼ˆä»…åœ¨ DRAGGING/OVER_TARGET æ—¶æ£€æµ‹ï¼‰

**å®ç°**ï¼š

```typescript
for (const element of this.registeredElements) {
  const rect = element.getBoundingClientRect()
  const isInside =
    clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom

  if (isInside) {
    // è¿›å…¥åŒºåŸŸé€»è¾‘
  }
}
```

### 3ï¸âƒ£ **ä¸ºä»€ä¹ˆä½¿ç”¨å…¨å±€å“åº”å¼çŠ¶æ€ï¼Ÿ**

**ä¼˜åŠ¿**ï¼š

- âœ… å•ä¸€æ•°æ®æº (Single Source of Truth)
- âœ… æ‰€æœ‰ç»„ä»¶è‡ªåŠ¨åŒæ­¥
- âœ… æ— éœ€æ‰‹åŠ¨ DOM æ“ä½œ
- âœ… æ˜“äºè°ƒè¯•å’Œè¿½è¸ª

**å®ç°**ï¼š

```typescript
// preview-state.ts
const _previewState = shallowRef<DragPreviewState | null>(null)
export const dragPreviewState = readonly(_previewState)
export const dragPreviewActions = {
  setKanbanPreview(data) { ... },
  updateDropIndex(index) { ... },
  triggerRebound() { ... },
}
```

### 4ï¸âƒ£ **ä¸ºä»€ä¹ˆéœ€è¦å¹½çµå…ƒç´ ï¼Ÿ**

**èŒè´£åˆ†ç¦»**ï¼š

- ğŸ­ **å¹½çµå…ƒç´  (Ghost)**ï¼šè·Ÿéšé¼ æ ‡ç§»åŠ¨ï¼Œæä¾›è§†è§‰åé¦ˆ
- ğŸ“¦ **å®ä½“å…ƒç´  (Physical)**ï¼šåœ¨ç›®æ ‡åˆ—è¡¨ä¸­çš„é¢„è§ˆä½ç½®

**å®ç°**ï¼š

```typescript
// åˆ›å»ºå¹½çµå…ƒç´ 
this.ghost = sourceElement.cloneNode(true)
this.ghost.style.position = 'fixed'
this.ghost.style.pointerEvents = 'none' // ä¸é˜»æŒ¡é¼ æ ‡äº‹ä»¶
this.ghost.style.zIndex = '9999'

// æ›´æ–°ä½ç½®
this.ghost.style.left = `${clientX - offset.x}px`
this.ghost.style.top = `${clientY - offset.y}px`
```

---

## ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶æ¶æ„

### **1. InteractDragController** (`drag-controller.ts`)

**èŒè´£**ï¼š

- ç®¡ç†æ‹–æ”¾çŠ¶æ€æœº (IDLE â†’ PREPARING â†’ DRAGGING â†’ OVER_TARGET â†’ DROPPING)
- é›†æˆ interact.js API
- æ‰‹åŠ¨ç¢°æ’æ£€æµ‹
- å¹½çµå…ƒç´ ç®¡ç†

**å…³é”®æ–¹æ³•**ï¼š

```typescript
class InteractDragController {
  // å®‰è£…å¯æ‹–æ‹½å…ƒç´ 
  installDraggable(selector: string, options: DraggableOptions)

  // æ³¨å†Œæ‹–æ”¾åŒº
  registerDropzone(element: HTMLElement, options: DropzoneOptions)

  // æ‰‹åŠ¨ç¢°æ’æ£€æµ‹ (æ ¸å¿ƒ)
  private detectDropzone(clientX: number, clientY: number)

  // çŠ¶æ€è½¬æ¢
  private startPreparing()
  private startDragging()
  private enterTarget()
  private leaveTarget()
  private executeDrop()
}
```

### **2. dragPreviewState** (`preview-state.ts`)

**èŒè´£**ï¼š

- ç»´æŠ¤å…¨å±€é¢„è§ˆçŠ¶æ€
- æä¾›å“åº”å¼ API

**æ•°æ®ç»“æ„**ï¼š

```typescript
type DragPreviewState = {
  type: 'kanban' | 'calendar'
  raw: {
    ghostTask: TaskCard
    sourceZoneId: string
    targetZoneId: string | null // null = å›å¼¹
    mousePosition: Position
  }
  computed: {
    dropIndex?: number
  }
}
```

### **3. useInteractDrag** (`useInteractDrag.ts`)

**èŒè´£**ï¼š

- Vue Composableï¼Œè¿æ¥ç»„ä»¶å’Œæ§åˆ¶å™¨
- æä¾›å“åº”å¼ `displayTasks`
- ç”Ÿå‘½å‘¨æœŸç®¡ç†

**æ ¸å¿ƒ API**ï¼š

```typescript
const { displayTasks, isDragging, isReceiving } = useInteractDrag({
  viewMetadata,
  tasks,
  containerRef,
  draggableSelector: '.task-card-wrapper-daily-today',
  dropzoneType: 'kanban',
  onDrop: async (session) => { ... }
})
```

---

## ğŸ¨ é¢„è§ˆæ¸²æŸ“é€»è¾‘

### **å®ä½“å…ƒç´ é¢„è§ˆè®¡ç®—**

```typescript
const displayTasks = computed(() => {
  const preview = dragPreviewState.value
  if (!preview) return tasks.value

  const { ghostTask, sourceZoneId, targetZoneId } = preview.raw
  const { dropIndex } = preview.computed

  // å›å¼¹çŠ¶æ€ï¼šæ‰€æœ‰åˆ—è¡¨æ¢å¤åŸå§‹çŠ¶æ€
  if (targetZoneId === null) {
    return tasks.value
  }

  // å½“å‰è§†å›¾æ˜¯ç›®æ ‡åˆ—è¡¨ï¼šæ˜¾ç¤ºé¢„è§ˆæ’å…¥
  if (targetZoneId === currentViewId) {
    const withoutDragged = tasks.value.filter((t) => t.id !== ghostTask.id)
    withoutDragged.splice(dropIndex, 0, { ...ghostTask, _isPreview: true })
    return withoutDragged
  }

  // å½“å‰è§†å›¾æ˜¯æºåˆ—è¡¨ï¼šç§»é™¤è¢«æ‹–åŠ¨çš„ä»»åŠ¡
  if (sourceZoneId === currentViewId) {
    return tasks.value.filter((t) => t.id !== ghostTask.id)
  }

  return tasks.value
})
```

---

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### **1. ç¢°æ’æ£€æµ‹ä¼˜åŒ–**

- âœ… ä»…åœ¨ `DRAGGING` å’Œ `OVER_TARGET` é˜¶æ®µæ£€æµ‹
- âœ… ä½¿ç”¨ `getBoundingClientRect()` è€Œé `elementFromPoint()`
- âœ… æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…åŒºåŸŸåç«‹å³ `break`

### **2. å“åº”å¼ä¼˜åŒ–**

- âœ… ä½¿ç”¨ `shallowRef` è€Œé `ref` (é¿å…æ·±åº¦å“åº”)
- âœ… åªåœ¨å¿…è¦æ—¶æ›´æ–° `dragPreviewState`
- âœ… ä½¿ç”¨ `computed` ç¼“å­˜ `displayTasks` è®¡ç®—

### **3. DOM æ“ä½œä¼˜åŒ–**

- âœ… å¹½çµå…ƒç´ ä½¿ç”¨ `transform` è€Œé `left/top`
- âœ… è®¾ç½® `pointer-events: none` é¿å…é˜»æŒ¡äº‹ä»¶
- âœ… æ‹–æ”¾ç»“æŸåç«‹å³ç§»é™¤å¹½çµå…ƒç´ 

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### **é—®é¢˜ 1ï¼šçŠ¶æ€æœºå¡åœ¨ IDLE**

**åŸå› **ï¼šæ²¡æœ‰æ­£ç¡®æ³¨å†Œ draggable
**æ’æŸ¥**ï¼š

```typescript
console.log('Registered selectors:', interactManager.registeredSelectors)
```

### **é—®é¢˜ 2ï¼šdropIndex ä¸æ›´æ–°**

**åŸå› **ï¼šæ²¡æœ‰è°ƒç”¨ `detectDropzone()` æˆ–é€‰æ‹©å™¨ä¸åŒ¹é…
**æ’æŸ¥**ï¼š

```typescript
// æ£€æŸ¥æ˜¯å¦æ¯ä¸€å¸§éƒ½åœ¨è°ƒç”¨
console.log('detectDropzone called:', clientX, clientY)
```

### **é—®é¢˜ 3ï¼šé¢„è§ˆå…ƒç´ ä¸æ˜¾ç¤º**

**åŸå› **ï¼š`displayTasks` è®¡ç®—é€»è¾‘é”™è¯¯
**æ’æŸ¥**ï¼š

```typescript
console.log('Preview state:', dragPreviewState.value)
console.log('Display tasks:', displayTasks.value)
```

---

## ğŸ“ è¿ç§»æŒ‡å—

### **ä»æ—§ç³»ç»Ÿè¿ç§»åˆ°æ–°ç³»ç»Ÿ**

**æ—§ä»£ç **ï¼š

```typescript
const { sameViewDrag, crossViewDrag, dragTransfer } = useDrag()
```

**æ–°ä»£ç **ï¼š

```typescript
const { displayTasks, isDragging } = useInteractDrag({
  viewMetadata,
  tasks,
  containerRef,
  draggableSelector: '.task-card-wrapper-daily-today',
  dropzoneType: 'kanban',
})
```

**æ¨¡æ¿å˜åŒ–**ï¼š

```vue
<!-- æ—§: v-for="task in tasks" -->
<KanbanTaskCard v-for="task in tasks" :key="task.id" />

<!-- æ–°: v-for="task in displayTasks" -->
<KanbanTaskCard v-for="task in displayTasks" :key="task.id" />
```

---

## âœ… æµ‹è¯•æ¸…å•

- [ ] åŒä¸€åˆ—è¡¨å†…æ‹–æ”¾æ’åº
- [ ] è·¨åˆ—è¡¨æ‹–æ”¾ç§»åŠ¨
- [ ] æ‹–åˆ°ç©ºåˆ—è¡¨
- [ ] æ‹–åˆ°åˆ—è¡¨é¡¶éƒ¨
- [ ] æ‹–åˆ°åˆ—è¡¨åº•éƒ¨
- [ ] æ‹–åˆ°æ— æ•ˆåŒºåŸŸï¼ˆåº”å›å¼¹ï¼‰
- [ ] å¿«é€Ÿè¿ç»­æ‹–åŠ¨
- [ ] æ‹–åŠ¨æ—¶æ»šåŠ¨é¡µé¢
- [ ] çŠ¶æ€æœºæ‰€æœ‰é˜¶æ®µè½¬æ¢
- [ ] è°ƒè¯•é¢æ¿æ˜¾ç¤ºæ­£ç¡®
