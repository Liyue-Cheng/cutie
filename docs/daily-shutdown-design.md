# 每日收尾 (Daily Shutdown) 设计方案

## 概述

每日收尾分为两个阶段：
1. **Stage 1: 今日回顾** - 处理今天的剩余任务
2. **Stage 2: 今日小仪式** - 可自定义的收尾 checklist

---

## Stage 1: 今日回顾

### 布局：三栏 + 工具栏

与 DailyPlanning 布局一致：

| 左栏 (Wizard) | 中栏 (未完成任务) | 右栏 (工具栏控制) |
|--------------|------------------|------------------|
| 引导 + 统计 | 今日未完成列表 | 已完成 / 每日 |

### 左栏 Wizard

**标题区域：**
- 标题：`收尾时间到了～`
- 副标题：`把今天的事情收拾一下`

**统计图表：**
- 环形图：今日完成率（已完成 / 总任务）
- 图例：显示已完成数、未完成数

**底部提示：**
- `未完成的可以拖到明天，或者放回暂存区～`

**按钮：**
- `下一步` → 进入 Stage 2

### 中栏：今日未完成任务

- viewKey: `daily::today::incomplete`
- 可拖拽到右栏

### 右栏工具栏选项

| 选项 | 图标 | 内容 |
|------|------|------|
| 已完成 | `CheckCircle` | 今日已完成任务列表（只读，展示成就） |
| 每日 | `Calendar` | 从明天开始的任务视图（可接收拖拽） |

---

## Stage 2: 今日小仪式

### 核心概念

- **可自定义的 checklist 流程**
- **完成状态每天重置**
- 用户可以创建、编辑、删除、排序步骤

### 布局

```
┌─────────────────────────────────────────────┐
│  ←                                      ☰   │  ← 顶栏：返回(→Stage1) + 编辑菜单
├─────────────────────────────────────────────┤
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  ☐  喝一杯水                        │   │  ← 步骤1
│  ├─────────────────────────────────────┤   │
│  │  ☐  整理桌面                        │   │  ← 步骤2
│  ├─────────────────────────────────────┤   │
│  │  ☐  写下明天最想做的一件事           │   │  ← 步骤3
│  ├─────────────────────────────────────┤   │
│  │  ☐  关闭工作相关的应用               │   │  ← 步骤4
│  └─────────────────────────────────────┘   │
│                                             │
│         早点休息，明天又是新的一天～         │  ← 温馨提示
└─────────────────────────────────────────────┘
```

### 空状态（无步骤时）

```
┌─────────────────────────────────────────────┐
│  ←                                      ☰   │
├─────────────────────────────────────────────┤
│                                             │
│                                             │
│                  ○                          │
│           还没有收尾步骤                     │
│        点击右上角编辑添加你的仪式             │
│                                             │
│                                             │
│         早点休息，明天又是新的一天～         │
└─────────────────────────────────────────────┘
```

### 小仪式编辑器（弹窗）

点击右上角 ☰ 图标后弹出编辑器：

```
┌─────────────────────────────────────────────┐
│  编辑小仪式                             ✕   │  ← 弹窗标题 + 关闭
├─────────────────────────────────────────────┤
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  ⋮⋮  喝一杯水                    🗑  │   │  ← 拖拽手柄 + 标题 + 删除
│  ├─────────────────────────────────────┤   │
│  │  ⋮⋮  整理桌面                    🗑  │   │
│  ├─────────────────────────────────────┤   │
│  │  ⋮⋮  写下明天最想做的一件事       🗑  │   │
│  ├─────────────────────────────────────┤   │
│  │  ⋮⋮  关闭工作相关的应用          🗑  │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  + 添加新步骤...                     │   │  ← 输入框
│  └─────────────────────────────────────┘   │
│                                             │
└─────────────────────────────────────────────┘
```

### 编辑器交互

| 操作 | 行为 |
|------|------|
| 拖拽 ⋮⋮ 手柄 | 调整步骤顺序 |
| 点击 🗑 | 删除步骤（需确认） |
| 输入框回车 | 添加新步骤 |
| 点击 ✕ 或外部 | 关闭编辑器，自动保存 |

### 主界面步骤项交互

| 操作 | 行为 |
|------|------|
| 点击复选框 | 切换完成状态（仅当日有效） |

---

## 数据模型（后端存储）

**shutdown_ritual_steps（步骤模板，持久化）**

| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| title | string | 步骤标题 |
| order_rank | string | lexorank 排序 |
| created_at | datetime | 创建时间 |

**shutdown_ritual_progress（每日进度）**

| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| step_id | UUID | 关联步骤 |
| date | date | 日期 (YYYY-MM-DD) |
| completed_at | datetime? | 完成时间，null 表示未完成 |

---

## 语言文件 (i18n)

```typescript
dailyShutdown: {
  // Stage 1
  stage1: {
    title: '收尾时间到了～',
    subtitle: '把今天的事情收拾一下',
    hint: '未完成的可以拖到明天，或者放回暂存区～',
  },
  // Stage 2
  stage2: {
    hint: '早点休息，明天又是新的一天～',
    emptyTitle: '还没有收尾步骤',
    emptyHint: '点击右上角编辑添加你的仪式',
  },
  // 编辑器
  editor: {
    title: '编辑小仪式',
    addPlaceholder: '添加新步骤...',
    deleteConfirm: '确定删除这个步骤吗？',
  },
  // 按钮
  next: '下一步',
  back: '返回',
  // 工具栏
  toolbar: {
    completed: '已完成',
    daily: '每日',
  },
}
```

---

## 设计决策

- ✅ 步骤只有标题，不支持描述/备注
- ✅ 不需要步骤分组
- ✅ 不记录收尾日志
- ✅ 不需要提醒功能
- ✅ 无"完成收尾"按钮，页面保持简洁
- ✅ Stage 2 返回按钮回到 Stage 1
- ✅ 进度重置：下次打开时检查日期，若非今日则清空当日进度

---

## TODO: 未来实现

- [ ] **午夜检查器**：需要实现午夜自动重置小仪式进度的功能（与现有的午夜刷新机制集成）
